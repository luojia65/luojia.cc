// build time:Thu Jun 21 2018 11:56:08 GMT+0800 (GMT+08:00)
function checkMobile(){var e=navigator.userAgent.match(/iPad/i)!=null;if(e){return false}var t=navigator.userAgent.match(/iphone|android|phone|mobile|wap|netfront|java|opera mobi|opera mini|ucweb|windows ce|symbian|symbianos|series|webos|sony|blackberry|dopod|nokia|samsung|palmsource|xda|pieplus|meizu|midp|cldc|motorola|foma|docomo|up.browser|up.link|blazer|helio|hosin|huawei|novarra|coolpad|webos|techfaith|palmsource|alcatel|amoi|ktouch|nexian|ericsson|philips|sagem|wellcom|bunjalloo|maui|smartphone|iemobile|spice|bird|zte-|longcos|pantech|gionee|portalmmm|jig browser|hiptop|benq|haier|^lct|320x320|240x320|176x220/i)!=null;if(t){return true}return false}function sskadmin(e){var t="";if(e.user_id==0x566430a867000400){if(checkMobile()){t='<span class="ua"><span class="sskadmin">Captain</span></span><br><br>'}else{t='<span class="ua"><span class="sskadmin">Captain</span></span>'}}else{if(checkMobile()){t="<br><br>"}}return t}function ua(e){var t=new Array;var s="";if(t=e.match(/FireFox\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_firefox"><i class="fa fa-firefox"></i> FireFox'}else if(t=e.match(/Maxthon([\d]*)\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_maxthon"><i class="fa fa-globe"></i> Maxthon'}else if(t=e.match(/BIDUBrowser([\d]*)\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_ucweb"><i class="fa fa-globe"></i> 百度浏览器'}else if(t=e.match(/UBrowser([\d]*)\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_ucweb"><i class="fa fa-globe"></i> UCBrowser'}else if(t=e.match(/UCBrowser([\d]*)\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_ucweb"><i class="fa fa-globe"></i> UCBrowser'}else if(t=e.match(/MetaSr/gi)){s='<span class="ua_sogou"><i class="fa fa-globe"></i> 搜狗浏览器'}else if(t=e.match(/2345Explorer/gi)){s='<span class="ua_2345explorer"><i class="fa fa-globe"></i> 2345王牌浏览器'}else if(t=e.match(/2345chrome/gi)){s='<span class="ua_2345chrome"><i class="fa fa-globe"></i> 2345加速浏览器'}else if(t=e.match(/LBBROWSER/gi)){s='<span class="ua_lbbrowser"><i class="fa fa-globe"></i> 猎豹安全浏览器'}else if(t=e.match(/MicroMessenger\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_qq"><i class="fa fa-weixin"></i> 微信'}else if(t=e.match(/QQBrowser\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_qq"><i class="fa fa-qq"></i> QQ浏览器'}else if(t=e.match(/QQ\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_qq"><i class="fa fa-qq"></i> QQ浏览器'}else if(t=e.match(/MiuiBrowser\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_mi"><i class="fa fa-globe"></i> Miui浏览器'}else if(t=e.match(/Chrome([\d]*)\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_chrome"><i class="fa fa-chrome"></i> Chrome'}else if(t=e.match(/safari\/([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_apple"><i class="fa fa-safari"></i> Safari'}else if(t=e.match(/Opera[\s|\/]([^\s]+)/gi)){var a=t[0].split("/");s='<span class="ua_opera"><i class="fa fa-opera"></i> Opera'}else if(t=e.match(/Trident\/7.0/gi)){s='<span class="ua_ie"><i class="fa fa-internet-explorer"></i> IE 11'}else if(t=e.match(/MSIE\s([^\s|;]+)/gi)){s='<span class="ua_ie"><i class="fa fa-internet-explorer"></i> IE'+" "+t[0]}else{s='<span class="ua_other"><i class="fa fa-globe"></i> 其它浏览器'}if(checkMobile()){Mobile="<br><br>"}else{Mobile=""}return s+"</span>"+Mobile}function os(e){var t="";if(e.match(/win/gi)){if(e.match(/nt 5.1/gi)){t='<span class="os_xp"><i class="fa fa-windows"></i> Windows XP'}else if(e.match(/nt 6.1/gi)){t='<span class="os_7"><i class="fa fa-windows"></i> Windows 7'}else if(e.match(/nt 6.2/gi)){t='<span class="os_8"><i class="fa fa-windows"></i> Windows 8'}else if(e.match(/nt 6.3/gi)){t='<span class="os_8_1"><i class="fa fa-windows"></i> Windows 8.1'}else if(e.match(/nt 10.0/gi)){t='<span class="os_8_1"><i class="fa fa-windows"></i> Windows 10'}else if(e.match(/nt 6.0/gi)){t='<span class="os_vista"><i class="fa fa-windows"></i> Windows Vista'}else if(e.match(/nt 5/gi)){t='<span class="os_2000"><i class="fa fa-windows"></i> Windows 2000'}else{t='<span class="os_windows"><i class="fa fa-windows"></i> Windows'}}else if(e.match(/android/gi)){t='<span class="os_android"><i class="fa fa-android"></i> Android'}else if(e.match(/ubuntu/gi)){t='<span class="os_ubuntu"><i class="fa fa-desktop"></i> Ubuntu'}else if(e.match(/linux/gi)){t='<span class="os_linux"><i class="fa fa-linux"></i> Linux'}else if(e.match(/mac/gi)){t='<span class="os_mac"><i class="fa fa-apple"></i> Mac OS X'}else if(e.match(/unix/gi)){t='<span class="os_unix"><i class="fa fa-desktop"></i> Unix'}else if(e.match(/symbian/gi)){t='<span class="os_nokia"><i class="fa fa-mobile"></i> Nokia SymbianOS'}else{t='<span class="os_other"><i class="fa fa-desktop"></i> 其它操作系统'}return t+"</span>"}(function(e,t,s){function a(e,t){for(var s in t)t[s]&&(e[s]?e[s].set(t[s]):e[s]=new ne(t[s]))}function i(e,t){for(var s in t)e[s]=t[s]}function r(){if(h.checkPermission())return;var t;while(t=N.shift()){var s=h.createNotification(t.iconUrl,t.title,t.body),a=t.url;try{s.onclick=function(){e.focus(),d.href=a,s.cancel()}}catch(i){}s.show(),setTimeout(function(){s.cancel&&s.cancel()},8e3)}}function n(){return de.data.user_id==0}function o(e,t,s){if(p)try{p.removeItem(e),p.removeItem(e+":timestamp"),p[e]=c.stringify(t),p[e+":timestamp"]=Math.floor(s)}catch(a){}}function l(e){C.theme=e,e!="none"&&C.injectStylesheet(q+"/styles/embed"+(e?"."+e+".css?"+T[e]:"."+short_name)+".css")}if(e.DUOSHUO)return;var d=e.location,c=e.JSON,u=e.XMLHttpRequest,p=c&&c.stringify&&e.localStorage,h=e.webkitNotifications,f=t.getElementsByTagName("head")[0]||t.getElementsByTagName("body")[0],m=e.navigator.userAgent,v=t.location.protocol=="https:"?"https:":"http:",g=0,b,_=function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t=/&(?!\w+;)|[<>"'`]/g,s=/[&<>"'`]/,a=function(t){return e[t]||"&amp;"};return function(e){return e==null||e===!1?"":s.test(e)?e.replace(t,a):e}}(),y=function(e){if(e.match(/^(http|https):/))return e;var s=t.createElement("a");return s.href=e,E.hrefNormalized?s.href:s.getAttribute("href",4)},w={start:0,end:0},k=function(e){var s=this,a=0,i=0,r,n,o,l,d;t.selection&&(n=t.selection.createRange(),n&&n.parentElement()==s&&(l=s.value.length,r=s.value.replace(/\r\n/g,"\n"),o=s.createTextRange(),o.moveToBookmark(n.getBookmark()),d=s.createTextRange(),d.collapse(!1),o.compareEndPoints("StartToEnd",d)>-1?a=i=l:(a=-o.moveStart("character",-l),a+=r.slice(0,a).split("\n").length-1,o.compareEndPoints("EndToEnd",d)>-1?i=l:(i=-o.moveEnd("character",-l),i+=r.slice(0,i).split("\n").length-1)))),w.start=a,w.end=i},x=function(e){return function(){return e}},T={"default":"d6149e1c",dark:"c11b5925",bluebox:"dbc0a9af"},q=v+"//static.duoshuo.com",C=e.DUOSHUO={DOMAIN:"duoshuo.com",REMOTE:"http://duoshuo.com",version:140327,loaded:{jQuery:typeof jQuery!="undefined"&&jQuery.fn.jquery>="1.5",smilies:!1,mzadxN:typeof mzadxN!="undefined"},libs:{jQuery:q+"/libs/embed.compat.js?24f8ca3f.js",smilies:q+"/libs/smilies.js?921e8eda.js",mzadxN:"http://js.miaozhen.com/mz_ad_serving.js"},sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",netease:"网易微博",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",taobao:"淘宝",msn:"MSN",google:"谷歌"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",netease:"网易",kaixin:"开心",sohu:"搜狐",baidu:"百度",taobao:"淘宝",msn:"MSN",google:"谷歌"},parseDate:function(e){return e.parse("2011-10-28T00:00:00+08:00")&&function(t){return new e(t)}||e.parse("2011/10/28T00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||e.parse("2011/10/28 00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new e(t)}}(Date),fullTime:function(e){var t=C.parseDate(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.toLocaleTimeString()},elapsedTime:function(e){var t=C.parseDate(e),s=new Date,a=(s-g-t)/1e3;return a<10?"刚刚":a<60?Math.round(a)+"秒前":a<3600?Math.round(a/60)+"分钟前":a<86400?Math.round(a/3600)+"小时前":(s.getFullYear()==t.getFullYear()?"":t.getFullYear()+"年")+(t.getMonth()+1)+"月"+t.getDate()+"日"},require:function(e,t){if(typeof e=="string")C.loaded[e]?t():W(C.libs[e],function(){C.loaded[e]=!0,t()});else if(typeof e=="object"){var s,a=!0;for(s=0;s<e.length;s++)(function(i){if(C.loaded[e[s]])return;a=!1,W(C.libs[i],function(){C.loaded[i]=!0;for(var s=0;s<e.length;s++)if(!C.loaded[e[s]])return;t()})})(e[s]);a&&t()}},getCookie:function(e){var a=" "+e+"=",i=t.cookie.split(";"),r=0,n,o,l;for(;r<i.length;r++){n=" "+i[r],o=n.indexOf(a);if(o>=0&&o+a.length==(l=n.indexOf("=")+1))return decodeURIComponent(n.substring(l,n.length).replace(/\+/g,""))}return s},param:function(e){var t=[];for(var a in e)e[a]!=s&&t.push(a+"="+encodeURIComponent(e[a]));return t.join("&")},ajax:function(e,t,a,i,r){var n=C.getCookie("duoshuo_token");a.v=C.version,n?a.jwt=n:X.remote_auth&&(a.remote_auth=X.remote_auth);if(u&&c&&c.parse){var o=new u;if(!!o&&"withCredentials"in o){var l;function d(e,t,s,a){var n,o,l,d=t;if(e>=200&&e<300||e===304)if(e===304)d="notmodified",n=!0;else try{o=c.parse(s),d="success",n=!0}catch(u){d="parsererror",l=u}else{l=d;if(!d||e)d="error",e<0&&(e=0);try{o=c.parse(s)}catch(u){d="parsererror",l=u}}n?i(o):d==="parseerror"?V("解析错误: "+s):(r&&r(o),V("出错啦("+o.code+"): "+o.errorMessage),o.errorTrace&&V(o.errorTrace))}o.open(e,C.hostUrl+t+".json"+(e=="GET"?"?"+C.param(a):""),!0),o.withCredentials=!0,o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.send(e=="GET"?null:C.param(a)),l=function(e,t){var a,i,r,n;try{if(l&&(t||o.readyState===4)){l=s;if(t)o.readyState!==4&&o.abort();else{a=o.status,r=o.getAllResponseHeaders();try{n=o.responseText}catch(e){}try{i=o.statusText}catch(c){i=""}}}}catch(u){t||d(-1,u)}n&&d(a,i,n,r)},o.readyState===4?l():o.onreadystatechange=l;return}}e!="GET"&&(a._method="POST");var p="cb_"+Math.round(Math.random()*1e6);C[p]=function(e){switch(e.code){case 0:i(e);break;default:r&&r(e),V("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&V(e.errorTrace)}},a.callback="DUOSHUO['"+p+"']",W(C.hostUrl+t+".jsonp?"+C.param(a))},injectStylesheet:function(e){var s=t.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,f.appendChild(s)},setCustomStyle:function(e){b||(b=t.createElement("style"),b.type="text/css",f.appendChild(b)),e=e.replace(/\}/g,"}\n");if(b.styleSheet)b.styleSheet.cssText=e;else{while(b.firstChild)b.removeChild(b.firstChild);b.appendChild(t.createTextNode(e))}},compileStyle:function(e){var t="",s={textbox:"#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper"};if(e)for(var a in e)t+=s[a]+"{"+e[a]+"}\n";return t},init:function(e,t){e&&!M[e]&&(M[e]=t||{type:"EmbedThread"}),C.initView&&C.initView()}},j=t.all,S,E=C.support=function(){var s=t.createElement("div");s.innerHTML='<a href="/a">a</a><input type="checkbox"/>';var a=s.getElementsByTagName("a")[0],i=s.getElementsByTagName("input")[0],r={placeholder:"placeholder"in i,touch:"ontouchstart"in e||"onmsgesturechange"in e,hrefNormalized:a.getAttribute("href")==="/a",iOS:m.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:m.match(/ \(Linux; U; Android /)};return S=!u&&typeof s.style.maxHeight=="undefined",r.authInWin=e.postMessage&&e.screen.width>800&&!r.iOS&&!r.android&&d.origin,r}(),P=function(e,s){var a=(t.body||t.documentElement).style;if(typeof a=="undefined")return!1;if(typeof a[e]=="string")return s?e:!0;var i=["Moz","Webkit","ms"],e=e.charAt(0).toUpperCase()+e.substr(1),r=0;for(;r<i.length;r++)if(typeof a[i[r]+e]=="string")return s?i[r]+e:!0},M=C.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"}},U=C.pagelets=[],O={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报","delete":"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},L=function(e,t,s,a){C.ajax("GET",e,t,s||function(){},a)},I=function(e,t,s,a){C.ajax("POST",e,t,s||function(){},a)},N=[],z,R=[],A=function(t){if(!("WebSocket"in e&&c))return!1;R.push(c.stringify(t)),z||(z=C.webSocket=new WebSocket("ws://ws.duoshuo.com:8201/"),z.onopen=function(){var e;if(z.readyState===1)while(e=R.shift())z.send(e)},z.onmessage=function(e){try{var t=0,s,a=c.parse(e.data)}catch(i){return}switch(a.type){case"post":for(;t<C.pagelets.length;t++)s=C.pagelets[t],s.threadId==a.thread_id&&s.onMessage(a);break;case"notification":N.push(a),r();break;default:}},e.addEventListener("beforeunload",function(){z.close()})),z.onopen()},H=C.Collections={},Q=C.Views={},B=C.Callbacks={},D=C.openDialog=function(e){return C.dialog!==s&&C.dialog.el.remove(),C.dialog=new Q.Dialog('<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+e+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>').open()},W=C.injectScript=function(a,i){var r=t.createElement("script"),n=t.head||t.getElementsByTagName("head")[0]||t.documentElement;r.type="text/javascript",r.src=a,r.async="async",r.charset="utf-8",i&&(r.onload=r.onreadystatechange=function(t,a){if(a||!r.readyState||/loaded|complete/.test(r.readyState))r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),r=s,a||i.call(e)}),n.insertBefore(r,n.firstChild)},V=C.log=function(e){typeof console=="object"&&console.log(e)},F=C.smilies={},$=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"],J=0,X,G=function(){var e={},t=0;for(;t<arguments.length;t++)arguments[t]&&i(e,arguments[t]);var s=C.param(e);return s?"?"+s:""},Y=function(){var e=C.getCookie("duoshuo_token");return e?{jwt:e}:X.remote_auth?{short_name:X.short_name,remote_auth:X.remote_auth}:s},Z=function(){return!X&&(X=e.duoshuoQuery)&&oe.trigger("queryDefined"),X};for(var K in Object.prototype)return alert("Object.prototype不为空，请不要给Object.prototype设置方法");var ee=C.templates={userUrl:function(e){return e.url},avatarUrl:function(e,t){return e.avatar_url||le.data.default_avatar_url},userAnchor:function(e){var t=ee.userUrl(e);return t?'<a rel="nofollow author" target="_blank" href="'+_(t)+'">'+_(e.name)+"</a>":_(e.name)},avatarImg:function(e,t){return'<img src="'+_(ee.avatarUrl(e,t))+'" alt="'+_(e.name)+'"'+(t?' style="width:'+t+"px;height:"+t+'px"':"")+"/>"},avatar:function(e,t){var s=ee.avatarImg(e,t),a=ee.userUrl(e);return a?'<a rel="nofollow author" target="_blank" href="'+_(a)+'" '+(e.user_id?" onclick=\"this.href='"+C.hostUrl+"/user-url/?user_id="+e.user_id+"';\"":"")+' title="'+_(e.name)+'">'+s+"</a>":s},timeHtml:function(e,t){return e?t?'<a href="'+t+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+e+'" title="'+C.fullTime(e)+'">'+C.elapsedTime(e)+"</a>":'<span class="ds-time" datetime="'+e+'" title="'+C.fullTime(e)+'">'+C.elapsedTime(e)+"</span>":""},serviceIcon:function(e,t){return'<a href="javascript:void(0)" class="ds-service-icon'+(t?"-grey":"")+" ds-"+e+'" data-service="'+e+'" title="'+C.sourceName[e]+'"></a>'},loginButtons:function(e){return'<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links">'+ee.serviceList()+ee.additionalServices()+"</div></div>"},poweredBy:function(e){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+_(e)+"</a></p>"},indicator:x('<div id="ds-indicator"></div>'),waitingImg:x('<div id="ds-waiting"></div>'),serviceList:function(e){var t='<ul class="ds-service-list">',s=["weibo","qq","renren","douban"],a=0;for(;a<s.length;a++)t+=ee.loginItem(s[a],e);return t+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li>'+"</ul>"},additionalServices:function(e){var t='<ul class="ds-service-list ds-additional-services">',s=["kaixin","netease","sohu","baidu","google"],a=0;for(;a<s.length;a++)t+=ee.loginItem(s[a],e);return t+"</ul>"},loginItem:function(e,t){var s=ee[t?"bindUrl":"loginUrl"](e);return'<li><a href="'+s+'" rel="nofollow" class="ds-service-link ds-'+e+'">'+C.serviceNames[e]+(de.data.social_uid[e]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a>"+"</li>"},loginUrl:function(e,t){return t||(t={}),X.sso&&X.sso.login&&(t.sso=1,t.redirect_uri=X.sso.login),C.hostUrl+"/login/"+e+"/"+G(t)},bindUrl:function(e){return C.hostUrl+"/bind/"+e+"/"+G(X.sso&&X.sso.login?{sso:1,redirect_uri:X.sso.login}:null,Y())},logoutUrl:function(){return C.hostUrl+"/logout/"+G(X.sso&&X.sso.logout?{sso:1,redirect_uri:X.sso.logout}:null)},likePost:function(e){return'<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+O.like+(e.likes>0?"("+e.likes+")":"")+"</a>"},ctxPost:function(e,t,s){var a=te(e);return'<li class="ds-ctx-entry"'+(s?' style="display:none"':"")+' data-post-id="'+e.post_id+'"><div class="ds-avatar">'+ee.avatar(a)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+ee.userAnchor(a)+ee.timeHtml(e.created_at,e.url)+(t>=0?'<div class="ds-ctx-nth" title="'+C.fullTime(e.created_at)+'">'+(t+1)+O.floor+"</div>":"")+'</div><div class="ds-ctx-content">'+e.message+(t>=0?'　　　　　　　<div class="ds-comment-actions'+(e.vote>0?" ds-post-liked":"")+'">'+ee.likePost(e)+' <a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+O.repost+"</a>"+' <a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+O.reply+"</a>"+"</div>":"")+"</div></div></li>"}},te=function(e){return he[e.author_id]&&he[e.author_id].data||e.author},se=function(e){var t=[];for(var s in e)t.push('<input type="hidden" name="'+s+'" value="'+_(e[s])+'" />');return t.join("\n")};for(;J<$.length;J++)C[$[J]]=function(e){return function(t,s){s=s||{},s.type=e,t&&!M[t]&&(M[t]=s),C.initSelector&&C.initSelector(t,s)}}($[J]),C["create"+$[J]]=function(e){return function(s,a){var i=t.createElement(s);for(var r in a)i.setAttribute("data-"+r,a[r]);return C[e](i),i}}($[J]);C.RecentCommentsWidget=C.RecentComments;var ae=0,ie=C.Class=function(){};ie.extend=function(e){function t(){!ae&&this.init&&this.init.apply(this,arguments)}ae=1;var s=new this;ae=0;for(var a in e)s[a]=e[a];return t.prototype=s,t.prototype.constructor=t,t.extend=arguments.callee,t};var re=C.Event=ie.extend({on:function(e,t){var a=this.handlers||(this.handlers={});return a[e]===s&&(a[e]=[]),a[e].push(t),this},trigger:function(e,t){var s=(this.handlers||(this.handlers={}))[e];if(s)for(var a=0;a<s.length;a++)if(s[a].call(this,t)===!1)break;return this}}),ne=C.Model=re.extend({init:function(e){this.data=e},reset:function(e){this.data=e,this.trigger("reset")},remove:function(e){this.data.splice(e,1),this.trigger("reset")},set:function(e,t){if(t===s)for(var a in e)this.data[a]=e[a];else this.data[e]=t;this.trigger("reset")}}),oe=C.events=new re,le=C.site=new ne,de=C.visitor=new ne,ce=C.unread=new ne,ue=C.threads={},pe=C.postPool={},he=C.users={};oe.on("queryDefined",function(){var e=X.short_name;C.hostUrl=e?v+"//"+e+"."+C.DOMAIN:C.REMOTE,X.theme&&l(X.theme);if(p){var t=p["ds_site_"+e],s=p["ds_lang_"+e];t&&le.reset(c.parse(t)),s&&i(O,c.parse(s))}}),Z(),C.loaded.jQuery&&(C.jQuery=e.jQuery),C.require("jQuery",function(){function c(e,t,s){if(e.find(".ds-post[data-post-id="+t.post_id+"]")[0])return;return e.find(".ds-post-placeholder").remove(),x(ee.post(t,s)).hide()[s.order=="asc"?"appendTo":"prependTo"](e).slideDown(function(){})}function u(e,t){var s;this.delegate("a.ds-post-likes","click",function(e){if(n())return v(),!1;var t=x(this).parent();return liked=t.hasClass("ds-post-liked"),matches=x(this).html().match(/\((\d+)\)/),likes=(matches?parseInt(matches[1]):0)+(liked?-1:1),I("/api/posts/vote",{post_id:t.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:liked?0:1}),x(this).html(x(this).html().replace(/\(\d+\)/,"")+(likes?"("+likes+")":"")),t[liked?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-post-repost","click",function(e){var t=x(this).closest(".ds-post-self"),s=pe[t.attr("data-post-id")];return C.repostDialog(s,""),!1}).delegate("a.ds-post-delete","click",function(t){if(confirm("确定要删除这条评论吗？")){var s=x(this).closest(".ds-post-self");I("/api/posts/remove",{post_id:s.attr("data-post-id")}),s.parent().fadeOut(200,function(){e.data.comments--,e.updateCounter("duoshuo"),x(this).remove()})}return!1}).delegate("a.ds-post-report","click",function(e){if(confirm("确定要举报这条评论吗？")){var t=x(this).closest(".ds-post-self");I("/api/posts/report",{post_id:t.attr("data-post-id")}),alert("感谢您的反馈！")}return!1}).delegate("a.ds-post-reply","click",function(a){var i=x(this),r=i.closest(".ds-comment-actions");if(r.hasClass("ds-reply-active"))s.el.fadeOut(200,function(){x(this).detach()}),r.removeClass("ds-reply-active");else{var n=i.closest(".ds-ctx-entry, .ds-post-self");s?s.actionsBar.removeClass("ds-reply-active"):(s=new Q.Replybox(e),s.render(!0).el.addClass("ds-inline-replybox").detach()),s.el.find("[name=parent_id]").val(n.attr("data-post-id")),s.el.show().appendTo(i.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),s.actionsBar=r.addClass("ds-reply-active"),t.max_depth<=1?s.postList=e.postList.el:(s.postList=n.siblings(".ds-children"),s.postList[0]||(s.postList=x('<ul class="ds-children"></ul>').insertAfter(n)))}return!1}).delegate("a.ds-weibo-comments","click",function(e){var s=x(this).closest(".ds-post-self"),a=s.attr("data-post-id"),i=s.data("source");if(s.attr("data-root-id")==0){var r=s.siblings(".ds-children");r[0]?r.remove():(r=x('<ul class="ds-children"></ul>').insertAfter(s),L("/api/posts/listComments",b({post_id:a}),function(e){z(e),r.append(x.map(e.response,function(e){return ee.post(e,t)}).join(""))}))}return!1}).delegate("a.ds-weibo-reposts","click",function(t){var s=x(this).closest(".ds-post-self"),a=pe[s.attr("data-post-id")],i=a.data.source;if(!de.data.social_uid[i=="qqt"?"qq":i]){f(i);return}var r=a.data.root_id,n=r!="0"?pe[r]:a,o="";if(r!="0"){var l=te(a.data);o=(i=="weibo"?"//@"+l.name:"|| @"+l.qqt_account)+":"+a.data.message}return C.repostDialog(n,o,e,i),!1}).delegate("a.ds-expand","click",function(e){var t=x(this).parent();return t.siblings().show(),t.remove(),!1}),E.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",function(t){var s=this;if(bubbleOutTimer&&me.owner==s)clearTimeout(bubbleOutTimer),bubbleOutTimer=0;else{var a=x(s);ge=setTimeout(function(){ge=0,me.owner=s,be();var t=a.offset(),i=e.el.offset(),r=a.innerWidth()/2,n=e.el.innerHeight()-(t.top-i.top)+6,o=t.left-i.left-35+(r>35?35:r);try{if(a.hasClass("ds-comment-context"))ve.attr("id","ds-ctx-bubble").attr("data-post-id",a.attr("data-post-id")).html('<ul id="ds-ctx">'+ee.ctxPost(pe[a.attr("data-parent-id")].data)+"</ul>"+'<div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>');else if(a.hasClass("ds-avatar")||a.hasClass("ds-user-name")){var l={},d=l.user_id=a.attr("data-user-id");if(!d)throw"no info";ve.attr("id","ds-user-card").attr("data-user-id",d).empty(),he[d]?ve.html(ee.userInfo(he[d].data)):L("/api/users/profile",b(l),function(e){var t=e.response;he[d]?he[d].set(t):he[d]=new ne(t),me.owner==s&&ve.html(ee.userInfo(t))})}me.css({bottom:n,left:o}).appendTo(e.innerEl)}catch(c){me.detach()}},200)}}).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",function(){ge?(clearTimeout(ge),ge=0):bubbleOutTimer||bubbleOut()})}function f(e){var t=ee[n()?"loginUrl":"bindUrl"](e);E.authInWin&&$(e,t)||(d.href=t)}function v(){var e=D("<h2>社交帐号登录</h2>"+ee.serviceList()+ee.additionalServices()).el.find(".ds-dialog").css("width","300px");J(e)}function b(e){var s={require:"site,visitor,nonce,serverTime,lang"+(_e++?"":",unread,log,extraCss"),site_ims:p&&p["ds_site_"+X.short_name+":timestamp"],lang_ims:p&&p["ds_lang_"+X.short_name+":timestamp"],referer:t.referrer};X.stylePatch&&(s.style_patch=X.stylePatch);for(var a in s)s[a]&&(!S||encodeURIComponent(s[a]).length<200)&&(e[a]=s[a]);return e}var x=C.jQuery,T=x(e),N=x(t),z=C.loadRequire=function(e){e.serverTime&&(g=(new Date).getTime()-e.serverTime*1e3),e.visitor&&(!de.data&&e.visitor.user_id&&h&&!h.checkPermission()&&A({logged_user_id:e.visitor.user_id}),de.reset(e.visitor)),e.site&&(le.reset(e.site),o("ds_site_"+X.short_name,e.site,e.serverTime)),!C.theme&&le.data.theme&&l(le.data.theme),e.lang&&(i(O,e.lang),o("ds_lang_"+X.short_name,e.lang,e.serverTime));if(e.stylesheets)for(var t=0;t<e.stylesheets.length;t++)C.injectStylesheet(e.stylesheets[t]);e.nonce&&(C.nonce=e.nonce),e.style&&C.setCustomStyle((e.style||"")+C.compileStyle(X.component_style)),e.unread&&ce.reset(e.unread)},R=function(e){e.stopPropagation()},B=function(e){(e.ctrlKey&&e.which==13||e.which==10)&&x(this.form).trigger("submit")},W=function(e){var t=x(this);t.height(Math.max(54,t.next(".ds-hidden-text").text(this.value).height()+27))},$=function(t,s){var a={weibo:[760,600],renren:[420,322],qq:[504,445],netease:[810,645],sohu:[972,600],google:[600,440],taobao:[480,585]}[t]||[550,400];return e.open(s+(s.indexOf("?")==-1?"?":"&")+C.param({origin:d.origin||"http://"+d.host}),"_blank","width="+a[0]+",height="+a[1]+",toolbar=no,menubar=no,location=yes")},J=function(e,t){E.authInWin&&e.find(t||"a.ds-service-link").click(function(e){var t=this.href.match(/\/(login|bind)\/(\w+)\//i);if(!t||!C.serviceNames[t[2]])return;return!$(t[2],this.href)})},K=function(e){return E.touch&&e.addClass("ds-touch"),P("transition")||e.addClass("ds-no-transition"),S&&e.addClass("ds-ie6"),x.support.opacity||e.addClass("ds-no-opacity"),e},ae=function(e){if(!E.placeholder){var t=e.attr("placeholder");e.val(t).focus(function(){this.value===t&&(this.value="")}).blur(function(){this.value===""&&(this.value=t)})}return e};if(e.postMessage){var ie=function(e){if(e.origin==="http://duoshuo.com")switch(e.data.type){case"login":d.href=e.data.redirectUrl;break;default:}};e.addEventListener?e.addEventListener("message",ie,!1):e.attachEvent&&e.attachEvent("onmessage",ie)}C.scrollTo=function(e){var t=e.offset().top;(t<T.scrollTop()||t>T.scrollTop()+T.height())&&x("html, body").animate({scrollTop:t-40},200,"swing")},C.toJSON=function(e){var t=/\r?\n/g,s=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,a=/^(?:select|textarea)/i,i=e.map(function(){return this.elements?x.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||a.test(this.nodeName)||s.test(this.type))}).map(function(e,s){var a=x(this).val();return a==null?null:x.isArray(a)?x.map(a,function(e,a){return{name:s.name,value:e.replace(t,"\r\n")}}):{name:s.name,value:a.replace(t,"\r\n")}}).toArray(),r={};return x.each(i,function(){r[this.name]=this.value}),r};var oe=C.Widget=re.extend({init:function(e,t){this.el=e,this.options=t||{},this.render()},render:function(){},reset:function(){},load:function(e){switch(e.code){case 0:z(e),this.onload(e);break;default:this.onError(e)}},onload:function(e){this.el.html(ee[this.tmpl].call(ee,e.response,x.extend(this.options,e.options)))},onMessage:function(){},onError:function(e){V("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&V(e.errorTrace)}}),fe=function(e){var t={"unread-comments":{title:"新留言及回复",apiUrl:"/api/users/unreadComments",tmpl:function(e){return'<li data-thread-id="'+e.thread.thread_id+'">'+x.map(e.authors,ee.userAnchor).join("、")+' 在 <a class="ds-read" href="'+e.thread.url+'#comments" target="_blank">'+_(e.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(e){var t=e.attr("data-thread-id");I("/api/threads/read",{thread_id:t}),ce.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"/api/users/unreadNotifications",tmpl:function(e){return'<li data-notification-id="'+e.notification_id+'" data-notification-type="'+e.type+'">'+e.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(e){var t=e.attr("data-notification-id");I("/api/notifications/read",{notification_id:t}),ce.data.notifications--}}}[e],s=D("<h2>"+t.title+"</h2>"+'<ul class="ds-unread-list"></ul>');s.on("close",C.resetNotify);var a=s.el.find(".ds-unread-list").delegate(".ds-delete","click",function(e){return x(this).parent().remove(),a.children().length===0&&s.close(),!1}).delegate(".ds-read","click",function(e){t.read(x(this).parent())});x("#ds-notify").hide(),L(t.apiUrl,{},function(e){s.el.find(".ds-unread-list").html(x.map(e.response,t.tmpl).join("\n"))}),h&&h.checkPermission()&&h.requestPermission(r)};C.resetNotify=function(){var e=x("#ds-notify"),s=ce.data;e[0]||(e=x('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[le.data.notify_position]).delegate(".ds-notify-unread a","click",function(e){return fe(x(this).data("type")),!1}).appendTo(t.body)),e.html('<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li'+(s.comments?"":' style="display:none;"')+'><a data-type="unread-comments" href="javascript:void(0);">你有'+s.comments+"条新回复</a></li><li"+(s.notifications?"":' style="display:none;"')+'><a data-type="unread-notifications" href="javascript:void(0);">你有'+s.notifications+"条系统消息</a></li></ul></div>")[(s.comments||s.notifications)&&le.data.notify_position!=="hidden"&&!x(".ds-dialog")[0]?"show":"hide"]()},ce.on("reset",C.resetNotify),ee.replybox=function(e,t){var s=e.options,a=de.data,i=[],r="",o,l={thread_id:e.threadId,parent_id:"",nonce:C.nonce};for(var d in a.repostOptions)a.repostOptions[d]&&(i.push(d),o=1),r+=ee.serviceIcon(d,!a.repostOptions[d]);return'<div class="ds-replybox"><a class="ds-avatar"'+(n()?' href="javascript:void(0);" onclick="return false"':' href="'+C.REMOTE+"/settings/avatar/"+G(Y())+'" target="_blank" title="设置头像"')+">"+ee.avatarImg(a)+"</a>"+'<form method="post">'+se(l)+'<div class="ds-textarea-wrapper ds-rounded-top">'+'<textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+_(O.leave_a_message)+'"></textarea>'+'<pre class="ds-hidden-text"></pre>'+"</div>"+'<div class="ds-post-toolbar">'+'<div class="ds-post-options ds-gradient-bg">'+'<span class="ds-sync">'+(!n()&&r?'<input id="ds-sync-checkbox'+(t?"-inline":"")+'" type="checkbox" name="repost" '+(o?'checked="checked" ':"")+'value="'+i.join(",")+'"> <label for="ds-sync-checkbox'+(t?"-inline":"")+'">'+O.share_to+"</label>"+r:"")+"</span>"+"</div>"+'<button class="ds-post-button" type="submit">'+_(O.post)+"</button>"+'<div class="ds-toolbar-buttons">'+(s.use_smilies?'<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>':"")+(s.use_images&&s.parse_html_enabled?'<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>':"")+"</div>"+"</div>"+"</form>"+"</div>"},Q.Replybox=function(e){this.embedThread=e},Q.Replybox.prototype={render:function(e){function s(e){e.data("submitting",!0),e.find(".ds-post-button").addClass("ds-waiting").html(O.posting)[0].disabled=!0}function a(e){e.data("submitting",!1),e.find(".ds-post-button").removeClass("ds-waiting").html(O.post)[0].disabled=!1}var i=this,r=i.embedThread,o=r.options,l=function(e){C.require("smilies",function(){})},d=i.el=x(ee.replybox(r,e)).click(l),u=d.find("form"),h=u.find("input[type=checkbox]")[0],f=u.find("a.ds-service-icon, a.ds-service-icon-grey"),m=ae(u.find("textarea")).focus(l).keyup(B).keyup(W).bind("focus mousedown mouseup keyup",k),v=d.find(".ds-add-emote").click(function(e){
var s=C.smiliesTooltip;return v.toggleClass("ds-expanded").hasClass("ds-expanded")?(s||(s=C.smiliesTooltip=new Q.SmiliesTooltip,s.render(),C.require("smilies",function(){s.reset("微博-默认")})),s.replybox=i,s.el.appendTo(t.body).css({top:i.el.offset().top+i.el.outerHeight()+4+"px",left:i.el.find(".ds-textarea-wrapper").offset().left+"px"}),x(t.body).click(b)):b(e),!1}),g=d.find(".ds-add-image").click(function(e){var s=m[0],a=s.value,i="请输入图片地址",r='<img src="'+i+'" />';if(t.selection){s.value=a.substring(0,w.start)+r+a.substring(w.end,a.length),s.value=s.value.replace("说点什么吧 ...",""),s.focus();var n=t.selection.createRange();n.collapse(),n.findText(i),n.select()}else{s.value=a.substring(0,s.selectionStart)+r+a.substring(s.selectionEnd);var o=s.value.search(i);s.setSelectionRange(o,o+i.length),s.focus()}e.preventDefault()}),b=i.hideSmilies=function(e){v.removeClass("ds-expanded"),C.smiliesTooltip.el.detach(),x(t.body).unbind("click",b)},y=function(e,t){var s=D('<h2>社交帐号登录</h2><div class="ds-icons-32">'+x.map(["weibo","qq","renren","kaixin","douban","netease","sohu"],function(e){return'<a class="ds-'+e+'" href="'+ee.loginUrl(e)+'">'+C.sourceName[e]+"</a>"}).join("")+"</div>"+(o.deny_anonymous?"":'<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+_(de.data.name)+'" required />'+'<label for="ds-dialog-name">名字(必填)</label>'+"</div>"+(o.require_guest_email?'<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+_(de.data.email)+'" required />'+'<label for="ds-dialog-email">邮箱(必填)</label>'+"</div>":"")+(o.require_guest_url?'<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+_(de.data.url||"")+'" />'+'<label for="ds-dialog-url">网址(可选)</label>'+"</div>":"")+'<button type="submit">发布</button>'+"</form>")),a=s.el.find(".ds-dialog").css("width","320px");J(a,".ds-icons-32 a");if(!o.deny_anonymous){var i=s.el.find("form");i.submit(function(e){var a=i.find("input[name=author_email]").val();return(a||o.require_guest_email)&&!a.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(alert("请输入一个有效的email地址."),!1):(t(C.toJSON(i)),s.close(),!1)}),i.find("input[name=author_name]")[0].focus()}};o.deny_anonymous&&m.focus(function(e){if(n()){y(u,T);var t=function(e){e.stopPropagation(),m.unbind("click",t)};m.click(t)}return!1});var T=function(e){s(u),I("/api/posts/create",x.extend(C.toJSON(u),e),function(e){var t=e.response,s=c(i.postList,t,o);o.order=="asc"==(o.formPosition=="top")&&C.scrollTo(s),pe[t.post_id]=new ne(t),r.data.comments++,r.updateCounter("duoshuo"),m.val("").trigger("keyup"),a(u),d.hasClass("ds-inline-replybox")&&(d.detach(),i.actionsBar.removeClass("ds-reply-active"));if(p)try{p.removeItem("ds_draft_"+r.threadId)}catch(n){}},function(e){a(u),alert(e.errorMessage)})};u.submit(function(e){if(u.data("submitting"))return!1;var t=x.trim(u[0].message.value);return t==""||!E.placeholder&&t==m.attr("placeholder")?(alert("您还没写内容呢"),!1):(n()?y(u,T):T(),!1)});var q=function(e){return x(e).hasClass("ds-service-icon-grey")?null:x(e).attr("data-service")};return f.click(function(){return x(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),h.value=x.map(f,q).join(","),h.checked=h.value!="",!1}),x(h).change(function(){var e=this.checked;f[e?"removeClass":"addClass"]("ds-service-icon-grey")[e?"addClass":"removeClass"]("ds-service-icon"),this.value=x.map(f,q).join(",")}),this}},Q.Dialog=re.extend({init:function(e,t){(this.el=x("#ds-wrapper"))[0]||(this.el=K(x('<div id="ds-wrapper"></div>'))),this.options=x.extend({width:600},t),e!==s&&x(e).attr("id","ds-reset").appendTo(this.el)},open:function(){var e=this;e.el.hide().appendTo(t.body).fadeIn(200),S&&e.el.css("top",T.scrollTop()+100),e.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(t){return e.close(),!1}).click(R);var s=function(t){if(t.which==27)return e.close(),!1},a=function(t){return e.close(),!1};return N.keydown(s),x(t.body).click(a),e.close=function(i){N.unbind("keydown",s),x(t.body).unbind("click",a),e.el.fadeOut(200,function(){x(this).remove()}),e.trigger("close")},e}}),ee.likePanel=function(e){return e.likes?'<span class="ds-highlight">'+e.likes+"</span> 人喜欢":""},ee.likeTooltip=function(e){var t={qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏",netease:"网易微博",sohu:"搜狐微博"},s=[];for(var a in t)s.push('<li><a class="ds-share-to-'+a+" ds-service-link ds-"+a+'" href="'+C.hostUrl+"/share-proxy/?"+C.param({service:a,thread_id:e.thread_id})+'">'+t[a]+"</a></li>");var i=Math.ceil(s.length/2);return'<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>'+s.slice(0,i).join("")+"</ul><ul>"+s.slice(i).join("")+'</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},Q.Meta=function(e){this.embedThread=e},Q.Meta.prototype={render:function(){var a=this,i=a.embedThread,r=i.data,o=a.el=x('<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded'+(r.user_vote>0?" ds-thread-liked":"")+'"><span class="ds-icon ds-icon-heart"></span>'+' <span class="ds-thread-like-text">'+(r.user_vote>0?"已喜欢":"喜欢")+'</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'),l=o.find(".ds-like-thread-button").click(function(n){var d=l.hasClass("ds-thread-liked");I("/api/threads/vote",{thread_id:i.threadId,vote:d?0:1},function(e){x.each(e.response.thread,function(e,t){r[e]=t}),a.resetLikePanel()}),l.toggleClass("ds-thread-liked"),l.find(".ds-thread-like-text").text(d?"喜欢":"已喜欢");var c=function(e){a.tooltip.detach(),x(t.body).unbind("click",c)};return d?a.tooltip&&c(n):(a.tooltip===s&&(a.tooltip=x(ee.likeTooltip(r)).click(R).delegate("a","click",function(t){switch(this.className){case"ds-like-tooltip-close":c(t);break;default:if(!e.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return}return!1})),a.tooltip.appendTo(i.innerEl).css({top:o.position().top+o.outerHeight()-4+"px",left:0}),x(t.body).click(c)),!1});return a.resetLikePanel(),n()&&o.hide(),a},resetLikePanel:function(){this.el.find(".ds-like-panel").html(ee.likePanel(this.embedThread.data))}},ee.postListHead=function(e){var t=e.data,s=e.options;return'<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+O.latest+'</a><a class="ds-order-asc">'+O.earliest+'</a><a class="ds-order-hot">'+O.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>'+(s.show_reposts&&t.reposts?'<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>':"")+(s.show_weibo&&t.weibo_reposts?'<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>':"")+(s.show_qqt&&t.qqt_reposts?'<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>':"")+"</ul>"+"</div>"},Q.PostListHead=function(e){this.embedThread=e},Q.PostListHead.prototype={render:function(){var e=this.embedThread,t=e.options,s=e.postList,a=this.el=x(ee.postListHead(e)),i=a.find("ul.ds-comments-tabs").delegate(".ds-tab a","click",function(t){i.find("a.ds-current").removeClass("ds-current"),s.params.page=1;var a=t.currentTarget;switch(a.className){case"ds-comments-tab-duoshuo":s.params.source="duoshuo",e.replybox.el.show();break;case"ds-comments-tab-repost":s.params.source="repost",e.replybox.el.hide();break;case"ds-comments-tab-weibo":s.params.source="weibo",e.replybox.el.hide();break;case"ds-comments-tab-qqt":s.params.source="qqt",e.replybox.el.hide();break;default:}return x(a).addClass("ds-current"),s.refetch(),!1}),r=a.find(".ds-sort").delegate("a","click",function(e){return r.find("a.ds-current").removeClass("ds-current"),s.params.order=t.order=this.className.replace("ds-order-",""),s.params.page=1,s.refetch(),x(this).addClass("ds-current"),!1});return r.find(".ds-order-"+s.params.order).addClass("ds-current"),this}},Q.Paginator=function(e){e=e||{};var t=this,s=t.el=e.el||x('<div class="ds-paginator"></div>'),a=t.collection=e.collection;s.delegate("a","click",function(e){return a.params.page=parseInt(this.innerHTML),a.refetch(),s.find(".ds-current").removeClass("ds-current"),x(this).addClass("ds-current"),!1})},Q.Paginator.prototype={reset:function(e){function t(e){i.push('<a data-page="'+e+'" href="javascript:void(0);">'+e+"</a>")}var s=this.collection.params.page||1,a,i=[];if(s>1){t(1),a=s>4?s-2:2,a>2&&i.push('<span class="page-break">...</span>');for(;a<s;a++)t(a)}i.push('<a data-page="'+s+'" href="javascript:void(0);" class="ds-current">'+s+"</a>");if(s<e.pages){for(a=s+1;a<=s+4&&a<e.pages;a++)t(a);a<e.pages&&i.push('<span class="page-break">...</span>'),t(e.pages)}this.el.html('<div class="ds-border"></div>'+i.join(" "))[e.pages>1?"show":"hide"]()}},ee.smiliesTooltip=function(e){var t='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(var s in e)t+="<li><a>"+s+"</a></li>";return t+'</ul><div class="ds-smilies-container"></div></div>'},C.addSmilies=function(e,t){var s=C.smiliesTooltip;s&&s.el.find("ul.ds-smilies-tabs").append("<li><a>"+e+"</a></li>"),C.smilies[e]=t},Q.SmiliesTooltip=function(){},Q.SmiliesTooltip.prototype={render:function(){var e=this,s=e.el=x(ee.smiliesTooltip(F));return s.click(R).find("ul.ds-smilies-tabs").delegate("a","click",function(t){e.reset(this.innerHTML)}),s.find(".ds-smilies-container").delegate("img","click",function(s){var a=e.replybox,i=a.el.find("textarea")[0],r=i.value;if(t.selection){i.value=r.substring(0,w.start)+this.title+r.substring(w.end,r.length),i.value=i.value.replace(O.leave_a_message,""),i.focus();var n=t.selection.createRange();n.moveStart("character",w.start+this.title.length),n.collapse(),n.select()}else{var o=i.selectionStart+this.title.length;i.value=r.substring(0,i.selectionStart)+this.title+r.substring(i.selectionEnd),i.setSelectionRange(o,o)}a.hideSmilies(),i.focus()}),this},reset:function(e){var t=this.el.find("ul.ds-smilies-tabs");t.find("a.ds-current").removeClass("ds-current"),t.find("a").filter(function(){return this.innerHTML==e}).addClass("ds-current");var s="<ul>";return x.each(F[e],function(t,a){var i=e.indexOf("微博")===0?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+a.replace("_org","_thumb"):q+"/images/smilies/"+a;e==="WordPress"&&(t=" "+t+" "),s+='<li><img src="'+i+'" title="'+_(t)+'" /></li>'}),s+="</ul>",this.el.find(".ds-smilies-container").html(s),this}},ee.postPlaceholder=function(){return'<li class="ds-post ds-post-placeholder">'+O.no_comments_yet+"</li>"},ee.post=function(e,t){var s=te(e),a=s.user_id?' data-user-id="'+s.user_id+'"':"",i=s.qqt_account||"",r=ee.timeHtml(e.created_at,e.url),n=e.parents||[];switch(e.source){case"duoshuo":r+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+O.reply+"</a>"+ee.likePost(e)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+O.repost+"</a>"+'<a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+O.report+"</a>"+(e.privileges["delete"]?'<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+O["delete"]+"</a>":"");break;case"qqt":case"weibo":r+='<a class="ds-weibo-comments" href="javascript:void(0);">'+O.comments+(e.type.match(/\-comment$/)?"":'(<span class="ds-count">'+e.comments+"</span>)")+"</a>"+'<a class="ds-weibo-reposts" href="javascript:void(0);">'+O.reposts+(e.type.match(/\-comment$/)?"":'(<span class="ds-count">'+e.reposts+"</span>)")+"</a>";break;default:}return'<li class="ds-post" data-post-id="'+e.post_id+'"><div class="ds-post-self" data-post-id="'+e.post_id+'" data-thread-id="'+e.thread_id+'" data-root-id="'+e.root_id+'" data-source="'+e.source+'"><div class="ds-avatar"'+a+">"+ee.avatar(s)+(C.sourceName[e.source]?ee.serviceIcon(e.source):"")+'</div><div class="ds-comment-body"><div class="ds-comment-header">'+(s.url?'<a class="ds-user-name ds-highlight" data-qqt-account="'+i+'" href="'+_(s.url)+'" '+(s.user_id?" onclick=\"this.href='"+C.hostUrl+"/user-url/?user_id="+s.user_id+"';\"":"")+' rel="nofollow" target="_blank"'+a+">"+_(s.name)+"</a>":'<span class="ds-user-name"'+a+' data-qqt-account="'+i+'">'+_(s.name)+"</span>")+'<span class="ua">'+sskadmin(e.author)+'</span><span class="ua">'+ua(e.agent)+'</span><span class="ua">'+os(e.agent)+"</span>"+"</div>"+(t.max_depth==1&&t.show_context&&n.length?'<ol id="ds-ctx">'+x.map(n,function(e,t){return(t==1&&n.length>2?'<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(n.length-2)+"条评论</a></li>":"")+(pe[e]?ee.ctxPost(pe[e].data,t,t&&t<n.length-1):"")}).join("")+"</ol>":"")+"<p>"+(n.length>=t.max_depth&&(!t.show_context||t.max_depth>1)&&e.parent_id&&pe[e.parent_id]?'<a class="ds-comment-context" data-post-id="'+e.post_id+'" data-parent-id="'+e.parent_id+'">'+O.reply_to+_(te(pe[e.parent_id].data).name)+": </a>":"")+e.message+'</p><div class="ds-comment-footer ds-comment-actions'+(e.vote>0?" ds-post-liked":"")+'">'+r+"</div></div></div>"+(t.max_depth>1&&(e.childrenArray||e.children)&&e.source!="weibo"&&e.source!="qqt"?'<ul class="ds-children">'+x.map(e.childrenArray||e.children,function(e){return pe[e]?ee.post(pe[e].data,t):""}).join("")+"</ul>":"")+"</li>"};var me=x('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),ve=me.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(e){L("/api/posts/conversation",{post_id:ve.attr("data-post-id")},function(e){t.el.find("ol").html(x.map(e.response,ee.ctxPost).join("\n"))});var t=D('<h2>查看对话</h2><ol id="ds-ctx"></ol>');return t.el.find(".ds-dialog").css("width","600px"),t.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),ge=bubbleOutTimer=0,be=function(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)};bubbleOut=function(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,me.detach()},400)},me.mouseenter(be).mouseleave(bubbleOut),ee.userInfo=function(e){var t=[];return x.each(e.social_uid,function(e,s){t.push('<a href="'+C.REMOTE+"/user-proxy/"+e+"/"+s+'/" target="_blank" class="ds-service-icon ds-'+e+'" title="'+C.sourceName[e]+'"></a>')}),'<a href="'+_(e.url)+'" class="ds-avatar" target="_blank">'+ee.avatarImg(e)+'</a><a href="'+_(e.url)+'" class="ds-user-name ds-highlight" target="_blank">'+_(e.name)+"</a>"+t.join("")+'<p class="ds-user-card-meta"><a href="'+C.REMOTE+"/profile/"+e.user_id+'/" target="_blank"><span class="ds-highlight">'+e.comments+"</span>条评论</a></p>"+(e.description?'<p class="ds-user-description">'+_(e.description)+"</p>":"")},H.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=x('<ul class="ds-comments"></ul>')},H.PostList.prototype={url:"/api/threads/listPosts",render:function(){return u.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(e){var t=this.embedThread.options;this.el.html(e[0]?x.map(e,function(e){return pe[e]?ee.post(pe[e].data,t):""}).join(""):ee.postPlaceholder())},refetch:function(){var e=this,s=x(ee.indicator()).appendTo(t.body).fadeIn(200);e.el.fadeTo(200,.5),L(e.url,e.params,function(t){a(pe,t.parentPosts||t.relatedPosts),a(he,t.users),e.reset(t.response),e.embedThread.paginator.reset(t.cursor),e.el.fadeTo(200,1),C.scrollTo(e.el),s.remove()})}},C.repostDialog=function(e,t,s,a){var i=D('<h2>转发到微博</h2><div class="ds-quote"><strong>@'+_(te(e.data).name)+"</strong>: "+e.data.message+"</div>"+"<form>"+se({post_id:e.data.post_id})+'<div class="ds-textarea-wrapper">'+'<textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+_(O.repost_reason)+'">'+_(t)+"</textarea>"+'<pre class="ds-hidden-text"></pre>'+"</div>"+'<div class="ds-actions">'+(a?se({"service[]":a}):'<label><input type="checkbox" name="service[]" value="weibo"'+(de.data.social_uid.weibo?' checked="checked"':"")+' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label>  '+'<label><input type="checkbox" name="service[]" value="qqt"'+(de.data.social_uid.qq?' checked="checked"':"")+' /><span class="ds-service-icon ds-qqt"></span>腾讯微博</label>')+'<button type="submit">'+O.repost+"</button>"+"</div>"+"</form>"),r=i.el.find("form").submit(function(e){return!a&&!r.find("[type=checkbox]:checked")[0]?(alert("还没有选发布到哪儿呢"),!1):(I("/api/posts/repost",C.toJSON(r),function(e){if(s&&a){var t=s.options,i=c(s.postList.el,e.response[a],t);t.order=="asc"==(t.formPosition=="top")&&C.scrollTo(i);var r=s.el.find(".ds-comments-tab-"+a+" span.ds-highlight");r.html(parseInt(r.html())+1)}}),i.close(),!1)});return r.find(".ds-actions [type=checkbox]").change(function(e){var t=this.value;if(this.checked&&!de.data.social_uid[t=="qqt"?"qq":t]){f(t);return}}),ae(r.find("textarea")).keyup(B).keyup(W).focus(),!1},ee.toolbar=function(e){var t=ee.logoutUrl();return'<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+C.REMOTE+"/settings/"+G(Y())+'">'+_(O.settings)+"</a></li>"+'<li><a rel="nofollow" href="'+t+'" style="border-bottom: none">登出</a></li>'+"</ul>"+"</div>"+'<div class="ds-visitor">'+(de.data.url?'<a class="ds-visitor-name" href="'+_(de.data.url)+'" target="_blank">'+_(de.data.name)+"</a>":'<span class="ds-visitor-name">'+_(de.data.name)+"</span>")+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a>'+"</div>"+"</div>"},Q.EmbedThread=oe.extend({uri:"/api/threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(m.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var e=this.el.attr("id","ds-thread").append(ee.waitingImg()),t=e.width(),s=e.data("url")||!e.attr("data-thread-id")&&x("link[rel=canonical]").attr("href");s?e.data("url",y(s)):e.data("container-url",d.href),t&&t<=400&&e.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(e){var t={duoshuo:["comments","评论"],repost:["reposts","转载"],weibo:["weibo_reposts","新浪微博"],qqt:["qqt_reposts","腾讯微博"]};for(var s in t)if(!e||e==s){var a=this.data[t[s][0]];this.el.find(".ds-comments-tab-"+s).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+s+'"></span>'+a:(a?'<span class="ds-highlight">'+a+"</span>条":"")+t[s][1])}},onError:function(e){this.el.html("评论框出错啦("+e.code+"): "+e.errorMessage)},onload:function(t){var i=this,r=i.threadId=t.thread.thread_id,o=t.cursor,l=i.options=t.options,d=i.innerEl=K(x('<div id="ds-reset"></div>').appendTo(i.el));i.data=t.thread,a(pe,t.parentPosts||t.relatedPosts),a(he,t.users),i.el.find("#ds-waiting").remove(),l.like_thread_enabled&&(i.meta=new Q.Meta(i),i.meta.render().el.appendTo(d)),l.hot_posts&&t.hotPosts&&t.hotPosts.length&&(i.hotPosts=new Q.HotPosts(x('<div class="ds-rounded"></div>'),{max_depth:1,show_context:l.show_context}),i.hotPosts.thread=i,i.hotPosts.el.appendTo(d),i.hotPosts.onload({response:t.hotPosts,options:{}})),i.postListHead=new Q.PostListHead(i),i.postList=new H.PostList({embedThread:i,params:{source:"duoshuo",thread_id:r,max_depth:l.max_depth,order:l.order,limit:l.limit}}),i.postList.render().reset(t.response),i.paginator=new Q.Paginator({collection:i.postList}),i.paginator.reset(o);var c=i.replybox=new Q.Replybox(i),u=c.render().el.find("textarea");c.postList=i.postList.el;if(p){var h="ds_draft_"+r;u.bind("focus blur keyup",function(e){var t=x(e.currentTarget).val();try{p[h]=t}catch(e){}}),p[h]&&u.val(p[h])}if(n()){var f=x(ee.loginButtons()).delegate("a.ds-more-services","click",function(){return f.find(".ds-additional-services").toggle(),!1});J(f)}else i.toolbar=x(ee.toolbar()).delegate(".ds-account-control","mouseenter",function(){x(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){x(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var e=D("<h2>绑定更多帐号</h2>"+ee.serviceList(1)+ee.additionalServices(1)+'<div style="clear:both"></div>').el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return J(e),!1}).delegate("a.ds-unread-comments-count","click",function(e){return fe("unread-comments"),!1});i.postListHead.render().el.appendTo(d)[l.formPosition=="top"?"before":"after"]('<a name="respond"></a>',i.toolbar||f,c.el).after(i.postList.el,i.paginator.el),i.updateCounter(),t.alerts&&x.each(t.alerts,function(e,t){x('<div class="ds-alert">'+t+"</div>").insertBefore(i.toolbar||f)}),l.message&&u.val(l.message).focus(),x(ee.poweredBy(l.poweredby_text)).appendTo(d),ce.on("reset",function(){var e=ce.data.comments||0;d.find("a.ds-unread-comments-count").html(e).attr("title",e?"你有"+e+"条新回复":"你没有新回复").css("display",e?"inline":"none")}),l.mzadx_id&&(C.require("mzadxN",function(){}),x('<div id="MZADX_'+l.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(d),__mz_rpq=e.__mz_rpq||[],__mz_rpq.push({l:[l.mzadx_id],r:"1",_srv:"MZADX",_callback:function(e,t){}})),C.thread=i,ce.data!==s&&ce.trigger("reset"),n()||A({visit_thread_id:i.threadId})},onMessage:function(e){c(this.postList.el,e,this.options)}}),ee.hotPosts=function(e,t){return'<div class="ds-header ds-gradient-bg">'+O.hot_posts_title+"</div><ul>"+x.map(e,function(e){return pe[e]?ee.post(pe[e].data,t):""}).join("")+"</ul>"},Q.HotPosts=oe.extend({params:"show-quote",tmpl:"hotPosts",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(e){oe.prototype.onload.call(this,e),u.call(this.el.find("ul"),this.thread,this.options)}}),ee.commentList=function(e,t){return x.map(e,function(e){var s=te(e);return'<li class="ds-comment'+(t.show_avatars?" ds-show-avatars":"")+'" data-post-id="'+e.post_id+'">'+(t.show_avatars?'<div class="ds-avatar">'+ee.avatar(s,t.avatar_size)+"</div>":"")+'<div class="ds-meta">'+ee.userAnchor(s)+(t.show_time?ee.timeHtml(e.created_at):"")+"</div>"+(t.show_title?'<div class="ds-thread-title">在 <a href="'+_(e.thread.url+"#comments")+'">'+_(e.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+e.message+"</div>":'<a class="ds-excerpt" title="'+_(e.thread.title)+' 中的评论" href="'+_(e.thread.url+"#comments")+'">'+e.message+"</a>")+"</li>"}).join("")},Q.RecentComments=oe.extend({uri:"/api/sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",tmpl:"commentList",render:function(){this.el.attr("id","ds-recent-comments")}}),ee.recentVisitors=function(e,t){return x.map(e,function(e){return'<div class="ds-avatar">'+ee.avatar(e,t.avatar_size)+"</div>"}).join("")},Q.RecentVisitors=oe.extend({uri:"/api/sites/listVisitors",params:"show-time avatar-size num-items channel-key",tmpl:"recentVisitors",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=x(ee.waitingImg()))}}),ee.topUsers=function(e,t){return x.map(e,function(e){return'<div class="ds-avatar">'+ee.avatar(e,t.avatar_size)+"<h4>"+e.name+"</h4>"+"</div>"}).join("")},Q.TopUsers=oe.extend({uri:"/api/sites/listTopUsers",params:"show-time avatar-size num-items channel-key",tmpl:"topUsers",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-users").append(this.waitingEl=x(ee.waitingImg()))}}),ee.topThreads=function(e,t){return x.map(e,function(e){return'<li><a target="_blank" href="'+_(e.url)+'" title="'+e.title+'">'+e.title+"</a>"+"</li>"}).join("")},Q.TopThreads=oe.extend({uri:"/api/sites/listTopThreads",params:"range num-items channel-key",tmpl:"topThreads",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=x(ee.waitingImg()))}}),ee.loginWidget=function(){var e='<div class="ds-icons-32">';return x.each(["weibo","qq","renren","kaixin","douban","netease","sohu"],function(t,s){e+='<a class="ds-'+s+'" href="'+ee.loginUrl(s)+'">'+C.sourceName[s]+"</a>"}),e+"</div>"},Q.LoginWidget=oe.extend({tmpl:"loginWidget",render:function(){var e=this.el;e.attr("id","ds-login").html(ee.loginWidget()),J(e,"a"),e.find("a.ds-logout").attr("href",ee.logoutUrl())}}),Q.ThreadCount=oe.extend({onload:function(e){var t=this.el,s=t.data("count-type")||"comments",a=e.data[s];t[t.data("replace")?"replaceWith":"html"](O[s+"_"+(a?a>1?"multiple":"one":"zero")].replace("{num}",a))}});var _e=0;C.initSelector=function(e,t){var s=[];Z()&&(x.isReady||!j)&&x(e).each(function(e,a){var i=x(a);if(i.data("initialized"))return;i.data("initialized",!0);var r=new Q[t.type](i,t);U.push(r);if(t.type==="ThreadCount"){var n=i.attr("data-thread-key");i.attr("data-channel-key")&&(n=i.attr("data-channel-key")+":"+n),s.push(n),ue[n]||(ue[n]=new ne({})),ue[n].on("reset",function(){r.onload(this)})}else if(r.uri){var o={};x.each(r.params.split(" "),function(e,t){o[t.replace(/-/g,"_")]=i.attr("data-"+t)||i.data(t)}),L(r.uri,b(o),function(e){r.load(e)})}}),s.length&&L("/api/threads/counts",b({threads:s.join(",")}),function(e){z(e),i(O,e.options),a(ue,e.response)})},(C.initView=function(){x.each(M,C.initSelector)})(),x(function(){if(!Z())return V("缺少duoshuoQuery的定义");setInterval(function(){x(".ds-time").each(function(){var e=x(this).attr("datetime");e&&(this.innerHTML=C.elapsedTime(e))})},2e4),X.ondomready&&X.ondomready(),C.initView(),!_e&&X.short_name&&L("/api/analytics/ping",b({}),z)})})})(window,document);
//rebuild by neat 